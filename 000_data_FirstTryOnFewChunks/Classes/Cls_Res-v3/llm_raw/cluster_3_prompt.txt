
You are a careful class resolution assistant.

You are given a set of candidate CLASSES that appear to belong,
or may plausibly belong, to the same semantic cluster.
This grouping is NOT guaranteed to be correct and should be treated as suggestive,
not definitive.

Your task is to conservatively refine the schema using this tentative grouping.

========================
SCHEMA STRUCTURE (CRITICAL)
========================

We are building a TWO-LAYER SCHEMA over entities:

Level 0: Class_Group        (connects related classes)
Level 1: Classes            (group entities)
Level 2: Entities

Structure:
Class_Group
  └── Class
        └── Entity

- Class_Group is the PRIMARY mechanism for connecting related classes.
- Classes that share a Class_Group are considered semantically related.
- This relationship propagates to their entities.

========================
IMPORTANT FIELD DISTINCTIONS
========================

- class_type_hint (existing field):
  A local, descriptive hint assigned to each class in isolation.
  It is often noisy, incomplete, and inconsistent across classes.
  Do NOT assume it is globally correct or reusable.

- Class_Group (NEW, CRUCIAL):
  A canonical upper-level grouping that emerges ONLY when multiple classes
  are considered together.
  It is used to connect related classes into a coherent schema.
  Class_Group is broader, more stable, and more reusable than class_type_hint.

Class_Group is NOT a synonym of class_type_hint.

========================
YOUR PRIMARY TASK
========================

For the given cluster of classes:

1) Assess whether any structural changes are REQUIRED:
   - merge truly duplicate or near-duplicate classes
   - reassign clearly mis-assigned entities
   - create a new class ONLY if strictly necessary
   - modify class metadata ONLY if meaningfully incorrect

2) ALWAYS assess and assign an appropriate Class_Group:
   - If Class_Group is missing, null, or marked as TBD → you MUST assign it.
   - If Class_Group exists but is incorrect, misleading, or too narrow/broad → you MAY modify it.
   - If everything else is correct, assigning or confirming Class_Group ALONE is sufficient.

Class_Group assignment is the MINIMUM expected outcome of this step.

========================
IMPORTANT CONSERVATISM RULE
========================

- Only order a function if a real semantic change is necessary.
- Do NOT perform cosmetic edits or unnecessary normalization.
- Do NOT rephrase labels or descriptions unless meaningfully wrong.
- If classes and entity memberships are already correct:
  → DO NOT order merge, create, reassign, or modify actions beyond Class_Group.

BALANCE & ORDERING (SHORT)
- Class_Group is required, but do NOT stop there: if there is clear evidence (overlapping members, contradictory descriptions, high-confidence mismatch) perform merges/reassigns/creates/modifies as needed.
- If you perform any structural changes, do them first; always include a final modify_class that sets or confirms the Class_Group as the last step for the cluster.


========================
AVAILABLE FUNCTIONS
========================

Return ONLY a JSON ARRAY of ordered function calls.

Each object must have:
- "function": one of
  ["merge_classes", "create_class", "reassign_entities", "modify_class"]
- "args": arguments as defined below.

1) merge_classes
args = {
  "class_ids": [<existing_class_ids>],
  "new_name": <string or null>,
  "new_description": <string or null>,
  "new_class_type_hint": <string or null>
}

2) create_class
args = {
  "name": <string>,
  "description": <string or null>,
  "class_type_hint": <string or null>,
  "member_ids": [<entity_ids>]   # optional
}

3) reassign_entities
args = {
  "entity_ids": [<entity_ids>],
  "from_class_id": <existing_class_id or null>,
  "to_class_id": <existing_or_new_class_id>
}

4) modify_class
args = {
  "class_id": <existing_class_id>,
  "new_name": <string or null>,
  "new_description": <string or null>,
  "new_class_type_hint": <string or null>,
  "new_class_group": <string>
}


========================
VALIDATION RULES
========================

- Use ONLY provided class_ids and entity_ids.
- Do NOT invent new entity ids or functions.
- Order matters: later steps may depend on earlier ones.

========================
STRATEGY GUIDANCE
========================

- Merge classes ONLY when they are genuinely redundant.
- If classes are related but distinct:
  → keep them separate and connect them via the SAME Class_Group.
- Think in terms of schema connectivity, not cleanup.

========================
INPUT CLASSES
========================

Each class includes:
- candidate_id
- class_label
- class_description
- class_type_hint
- class_group (may be null or "TBD")
- confidence
- evidence_excerpt
- member_ids
- members (entity id, name, description, type)

[
  {
    "candidate_id": "ClsC_3a7fbd8d",
    "class_label": "Hydrogen-Induced Cracking",
    "class_description": "Cracking mechanisms in metals caused by hydrogen, including SOHIC and HIC.",
    "class_type_hint": "Damage Mechanism",
    "class_group": "TBD",
    "confidence": 0.85,
    "evidence_excerpt": "Cracking in hydrogen-exposed steel, often near welds.",
    "member_ids": [
      "Can_04c94b79",
      "En_d0d2d7c7"
    ],
    "members": [
      {
        "id": "Can_04c94b79",
        "entity_name": "Stress Oriented Hydrogen Induced Cracking (SOHIC)",
        "entity_description": "A type of cracking in steel caused by the presence of hydrogen and stress, often near welds, characterized by cracks aligned nearly perpendicular to stress.",
        "entity_type_hint": "DamageMechanism"
      },
      {
        "id": "En_d0d2d7c7",
        "entity_name": "Hydrogen Induced Cracking (HIC)",
        "entity_description": "Stepwise internal cracks in metal connecting hydrogen blisters, occurring without external stress.",
        "entity_type_hint": "DamageMechanism"
      }
    ]
  },
  {
    "candidate_id": "ClsC_606baa04",
    "class_label": "Sulfide and Acid Stress Cracking",
    "class_description": "Cracking mechanisms in metals due to sulfide and acid environments, including sulfide stress cracking and polythionic acid stress corrosion cracking.",
    "class_type_hint": "Damage Mechanism",
    "class_group": "TBD",
    "confidence": 0.82,
    "evidence_excerpt": "Cracking in sulfide and acid environments.",
    "member_ids": [
      "En_a9e4aa90",
      "En_c7aaaee0"
    ],
    "members": [
      {
        "id": "En_a9e4aa90",
        "entity_name": "sulfide stress cracking",
        "entity_description": "A form of hydrogen embrittlement that occurs in metals exposed to sulfide environments.",
        "entity_type_hint": "DamageMechanism"
      },
      {
        "id": "En_c7aaaee0",
        "entity_name": "polythionic acid stress corrosion cracking",
        "entity_description": "A type of corrosion that affects austenitic stainless steels and other austenitic alloys during shutdowns.",
        "entity_type_hint": "DamageMechanism"
      }
    ]
  },
  {
    "candidate_id": "ClsC_31d21beb",
    "class_label": "Environmental Cracking",
    "class_description": "Cracking mechanisms in metals due to environmental factors, including wet H2S environments and carbon steel weldments.",
    "class_type_hint": "Damage Mechanism",
    "class_group": "TBD",
    "confidence": 0.8,
    "evidence_excerpt": "Cracking in corrosive environments.",
    "member_ids": [
      "En_19cc48f3",
      "En_1a88e9ed"
    ],
    "members": [
      {
        "id": "En_19cc48f3",
        "entity_name": "cracking in wet H2S environments",
        "entity_description": "Cracking of pressure vessels in environments containing wet hydrogen sulfide.",
        "entity_type_hint": "DamageMechanism"
      },
      {
        "id": "En_1a88e9ed",
        "entity_name": "environmental cracking of carbon steel weldments",
        "entity_description": "Cracking that occurs in carbon steel weldments due to environmental factors in corrosive environments.",
        "entity_type_hint": "DamageMechanism"
      }
    ]
  },
  {
    "candidate_id": "ClsC_c0bd7502",
    "class_label": "General Stress Corrosion Cracking",
    "class_description": "Cracking mechanisms in materials due to stress and corrosive environments, including stress corrosion cracking and environment assisted cracking.",
    "class_type_hint": "Damage Mechanism",
    "class_group": "TBD",
    "confidence": 0.83,
    "evidence_excerpt": "Cracking due to stress and corrosive environments.",
    "member_ids": [
      "En_a608496c",
      "En_038f5dc2"
    ],
    "members": [
      {
        "id": "En_a608496c",
        "entity_name": "stress corrosion cracking",
        "entity_description": "A failure mechanism where cracks form in a material due to the combined effects of tensile stress and a corrosive environment.",
        "entity_type_hint": "DamageMechanism"
      },
      {
        "id": "En_038f5dc2",
        "entity_name": "Environment Assisted Cracking",
        "entity_description": "Cracking of materials facilitated by environmental conditions.",
        "entity_type_hint": "DamageMechanism"
      }
    ]
  },
  {
    "candidate_id": "ClsC_80b2a52f",
    "class_label": "Material Damage Mechanisms",
    "class_description": "Mechanisms causing material degradation, including mechanical, metallurgical, and thickness loss processes.",
    "class_type_hint": "Failure Mechanism",
    "class_group": "TBD",
    "confidence": 0.85,
    "evidence_excerpt": "The mechanisms are divided into sections: a) Mechanical and Metallurgical Failure, b) Uniform or Localized Loss of Thickness.",
    "member_ids": [
      "En_6a5f3538",
      "En_8ed6cfa3"
    ],
    "members": [
      {
        "id": "En_6a5f3538",
        "entity_name": "Mechanical and Metallurgical Failure",
        "entity_description": "Failure mechanisms related to mechanical and metallurgical processes in various industries.",
        "entity_type_hint": "DamageMechanism"
      },
      {
        "id": "En_8ed6cfa3",
        "entity_name": "Uniform or Localized Loss of Thickness",
        "entity_description": "A damage mechanism involving the reduction of material thickness, either uniformly or in specific areas.",
        "entity_type_hint": "DamageMechanism"
      }
    ]
  }
]

========================
OUTPUT
========================

Return ONLY the JSON array of ordered function calls.
Return [] ONLY if you are absolutely certain that even Class_Group is already correct.
