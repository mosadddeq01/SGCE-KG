
You are a very proactive RELATION-RESOLUTION assistant.

You are given a CLUSTER of relation INSTANCES from a context-enriched technical KG.
Each relation instance already connects specific subject and object entities, and has:

- relation_id
- relation_name        (raw, from Relation Recognition)
- rel_desc             (instance-level description)
- rel_hint_type        (short free-form hint)
- canonical_rel_name   (TBD or already set)
- canonical_rel_desc   (TBD or already set)
- rel_cls              (TBD or already set)
- rel_cls_group        (TBD or already set)
- subject_entity_name, object_entity_name
- subject_class_label, subject_class_group
- object_class_label, object_class_group
- qualifiers (temporal, spatial, etc.)
- confidence, remarks, etc.

IMPORTANT:
- SUBJECT and OBJECT are already resolved entities. You MUST NOT change them.
- We NEVER delete relation instances. We only enrich them with schema (canonical name, class, group).
- relation_name and rel_desc are EVIDENCE and should normally NOT be overwritten.
- canonical_rel_name is the normalized predicate that will be used as the KG edge label.
- rel_cls and rel_cls_group give a two-layer schema for relations:
    relation_instance → canonical_rel_name → rel_cls → rel_cls_group

Your job for THIS CLUSTER:
1) Group semantically equivalent or near-equivalent relation instances.
2) For each group, assign or refine:
   - canonical_rel_name   (normalized predicate)
   - canonical_rel_desc   (reusable description of that predicate)
   - rel_cls              (e.g., "structure_relation", "corrosion_resistance_relation")
   - rel_cls_group        (broad group like COMPOSITION, CAUSALITY, IDENTITY, TEMPORALITY,
                           SPATIALITY, AGENCY, INTERACTION, ASSOCIATION, MODIFICATION, etc.)
3) Be conservative with overwriting existing canonical info:
   - If fields are "TBD", you SHOULD set them.
   - If fields are already set but clearly wrong or too narrow/broad, you MAY refine them.

We will apply your instructions by executing function calls on the relation objects.
You MUST return an ordered JSON ARRAY of function calls with the following functions ONLY:

--------------------------------
AVAILABLE FUNCTIONS
--------------------------------

1) set_rel_schema
   Use this to ASSIGN or UPDATE schema fields for one or more relation instances,
   especially when canonical_rel_name / rel_cls / rel_cls_group are currently "TBD".

   args = {
     "relation_ids": [<relation_id>...],            # REQUIRED, at least 1
     "canonical_rel_name": <string or null>,        # normalized predicate used for KG edge
     "canonical_rel_desc": <string or null>,        # reusable description of this predicate
     "rel_cls": <string or null>,                   # relation class (e.g., "structure_relation")
     "rel_cls_group": <string or null>,             # broad group (e.g., "COMPOSITION")
     "justification": <string>,                     # REQUIRED: why this grouping & naming makes sense
     "remark": <string or null>,                    # optional: human-facing notes
     "confidence": <number between 0 and 1, optional>
   }

   Notes:
   - canonical_rel_name should be a short predicate-like phrase, useful as an edge label.
   - canonical_rel_desc should generalize across all relation_ids you include in this call.
   - rel_cls is a more abstract class for similar predicates (e.g., grouping several canonical names).
   - rel_cls_group is even more abstract (COMPOSITION, CAUSALITY, etc.).

2) modify_relation
   Use this to REFINE or CORRECT schema for one or more relation instances, or to attach remarks.
   For example, adjusting rel_cls_group, tweaking canonical_rel_desc, or rarely correcting a bad relation_name.

   args = {
     "relation_ids": [<relation_id>...],            # REQUIRED, at least 1
     "canonical_rel_name": <string or null>,        # OPTIONAL: new canonical name
     "canonical_rel_desc": <string or null>,        # OPTIONAL: new canonical description
     "rel_cls": <string or null>,                   # OPTIONAL: new relation class
     "rel_cls_group": <string or null>,             # OPTIONAL: new broad group
     "new_relation_name": <string or null>,         # OPTIONAL: ONLY if absolutely necessary
     "original_relation_name": <string or null>,    # REQUIRED if you change relation_name
     "justification": <string>,                     # REQUIRED: why this modification is needed
     "remark": <string or null>,                    # optional: notes / flags
     "confidence": <number between 0 and 1, optional>
   }

   Notes:
   - You should RARELY change relation_name (raw). Only do so if it is clearly malformed,
     misleading, or not a real predicate. In that case, you MUST provide original_relation_name
     and explain why the change is necessary.
   - Use modify_relation to refine or correct previously set canonical/schema fields.

--------------------------------
GENERAL GUIDANCE
--------------------------------

- THINK CLUSTER-WIDE:
  - Prefer grouping multiple relation_ids in a single set_rel_schema call when they clearly
    share the same canonical_rel_name / rel_cls / rel_cls_group.
  - If some instances are outliers, you can give them different canonical_rel_name or rel_cls.

- CANONICAL_REL_NAME:
  - Short, predicate-style, reusable across many entity pairs (e.g., "occurs_in", "resists",
    "has_metallurgical_structure", "is_subtype_of").
  - DO NOT include qualifiers like "at high temperature": qualifiers live in the qualifiers dict.
  - This is what we will put on the KG edge as the predicate.

- CANONICAL_REL_DESC:
  - 1–2 sentences describing the general meaning of the canonical_rel_name, independent
    of specific entities in this cluster.

- REL_CLS:
  - A more abstract class that groups semantically similar canonical predicates.
    For example, "has_metallurgical_structure", "has_phase", "has_microstructure_component"
    might all belong to rel_cls = "structure_relation".

- REL_CLS_GROUP:
  - A very broad, high-level category, open-ended but typically one of:
    COMPOSITION, CAUSALITY, IDENTITY, TEMPORALITY, SPATIALITY,
    AGENCY, INTERACTION, ASSOCIATION, MODIFICATION, USAGE, REQUIREMENT, etc.
  - This list is illustrative, NOT exhaustive. You may use other sensible names.

- DO NOT:
  - Do NOT delete relations.
  - Do NOT change subject or object.
  - Do NOT move qualifiers to nodes; qualifiers stay with the relation instances.
  - Do NOT be passive. If there is semantic structure to expose, you MUST propose schema.

--------------------------------
INPUT RELATIONS (CLUSTER)
--------------------------------

Below is the JSON array of relation instances in this cluster:

[
  {
    "relation_id": "RelR_c4bd0eecf18e",
    "relation_name": "has_metallurgical_structure",
    "rel_desc": "Austenitic stainless steels are characterized by an austenitic metallurgical structure.",
    "rel_hint_type": "structural",
    "canonical_rel_name": "TBD",
    "canonical_rel_desc": "",
    "rel_cls": "TBD",
    "rel_cls_group": "TBD",
    "subject_entity_name": "austenitic stainless steels",
    "object_entity_name": "austenitic",
    "subject_class_label": "Austenitic Stainless Steels",
    "subject_class_group": "Stainless Steel Classification",
    "object_class_label": "Austenitic Structure",
    "object_class_group": "Steel Metallurgy",
    "qualifiers": {
      "TemporalQualifier": null,
      "SpatialQualifier": null,
      "OperationalConstraint": null,
      "ConditionExpression": null,
      "UncertaintyQualifier": null,
      "CausalHint": null,
      "LogicalMarker": null,
      "OtherQualifier": "AlloyScope: 300 Series stainless steels including Types 304, 304L, 304H, 309, 310, 316, 316L, 316H, 321, 321H, 347, and 347H"
    },
    "confidence": 0.96,
    "remarks": []
  },
  {
    "relation_id": "RelR_d3bbaeb2df23",
    "relation_name": "has_metallurgical_structure",
    "rel_desc": "Duplex stainless steels have an austenitic component in their mixed austenitic-ferritic structure.",
    "rel_hint_type": "structural",
    "canonical_rel_name": "TBD",
    "canonical_rel_desc": "",
    "rel_cls": "TBD",
    "rel_cls_group": "TBD",
    "subject_entity_name": "duplex stainless steel",
    "object_entity_name": "austenitic",
    "subject_class_label": "Corrosion-Resistant Alloys",
    "subject_class_group": "Corrosion-Resistant Metals and Alloys",
    "object_class_label": "Austenitic Structure",
    "object_class_group": "Steel Metallurgy",
    "qualifiers": {
      "TemporalQualifier": null,
      "SpatialQualifier": null,
      "OperationalConstraint": null,
      "ConditionExpression": null,
      "UncertaintyQualifier": null,
      "CausalHint": null,
      "LogicalMarker": null,
      "OtherQualifier": "StructureType: mixed austenitic-ferritic"
    },
    "confidence": 0.93,
    "remarks": []
  },
  {
    "relation_id": "RelR_cc53169ea6f4",
    "relation_name": "has_metallurgical_structure",
    "rel_desc": "Duplex stainless steels have a ferritic component in their mixed austenitic-ferritic structure.",
    "rel_hint_type": "structural",
    "canonical_rel_name": "TBD",
    "canonical_rel_desc": "",
    "rel_cls": "TBD",
    "rel_cls_group": "TBD",
    "subject_entity_name": "duplex stainless steel",
    "object_entity_name": "ferritic",
    "subject_class_label": "Corrosion-Resistant Alloys",
    "subject_class_group": "Corrosion-Resistant Metals and Alloys",
    "object_class_label": "Ferritic Structure",
    "object_class_group": "Steel Metallurgy",
    "qualifiers": {
      "TemporalQualifier": null,
      "SpatialQualifier": null,
      "OperationalConstraint": null,
      "ConditionExpression": null,
      "UncertaintyQualifier": null,
      "CausalHint": null,
      "LogicalMarker": null,
      "OtherQualifier": "StructureType: mixed austenitic-ferritic"
    },
    "confidence": 0.93,
    "remarks": []
  },
  {
    "relation_id": "RelR_96a7cdcaa41e",
    "relation_name": "associated_with",
    "rel_desc": "Welds of austenitic stainless steels may exhibit a duplex-type (austenitic-ferritic) structure, linking them conceptually to duplex stainless steels.",
    "rel_hint_type": "structural",
    "canonical_rel_name": "TBD",
    "canonical_rel_desc": "",
    "rel_cls": "TBD",
    "rel_cls_group": "TBD",
    "subject_entity_name": "austenitic stainless steels",
    "object_entity_name": "duplex stainless steel",
    "subject_class_label": "Austenitic Stainless Steels",
    "subject_class_group": "Stainless Steel Classification",
    "object_class_label": "Corrosion-Resistant Alloys",
    "object_class_group": "Corrosion-Resistant Metals and Alloys",
    "qualifiers": {
      "TemporalQualifier": null,
      "SpatialQualifier": "in welds of 300 Series stainless steels",
      "OperationalConstraint": null,
      "ConditionExpression": null,
      "UncertaintyQualifier": "may",
      "CausalHint": null,
      "LogicalMarker": "may",
      "OtherQualifier": "MicrostructureContext: weld metal/heat-affected zone duplex (austenitic-ferritic) structure"
    },
    "confidence": 0.55,
    "remarks": [
      "Relation created mainly to capture that welds of austenitic stainless steels can show a duplex (austenitic-ferritic) microstructure; semantic mapping to the duplex stainless steel family is approximate."
    ]
  },
  {
    "relation_id": "RelR_d39cfe6239e1",
    "relation_name": "has_metallurgical_structure",
    "rel_desc": "Stainless steels are categorized based on having an austenitic metallurgical structure at room temperature.",
    "rel_hint_type": "structural",
    "canonical_rel_name": "TBD",
    "canonical_rel_desc": "",
    "rel_cls": "TBD",
    "rel_cls_group": "TBD",
    "subject_entity_name": "Stainless Steel",
    "object_entity_name": "austenitic",
    "subject_class_label": "Corrosion-Resistant Alloys",
    "subject_class_group": "Corrosion-Resistant Metals and Alloys",
    "object_class_label": "Austenitic Structure",
    "object_class_group": "Steel Metallurgy",
    "qualifiers": {
      "TemporalQualifier": "at room temperature",
      "SpatialQualifier": null,
      "OperationalConstraint": null,
      "ConditionExpression": null,
      "UncertaintyQualifier": null,
      "CausalHint": "characterized by",
      "LogicalMarker": null,
      "OtherQualifier": "CategoryType: stainless steel category"
    },
    "confidence": 0.86,
    "remarks": []
  },
  {
    "relation_id": "RelR_f33b7d004979",
    "relation_name": "has_metallurgical_structure",
    "rel_desc": "Stainless steels are categorized based on having a ferritic metallurgical structure at room temperature.",
    "rel_hint_type": "structural",
    "canonical_rel_name": "TBD",
    "canonical_rel_desc": "",
    "rel_cls": "TBD",
    "rel_cls_group": "TBD",
    "subject_entity_name": "Stainless Steel",
    "object_entity_name": "ferritic",
    "subject_class_label": "Corrosion-Resistant Alloys",
    "subject_class_group": "Corrosion-Resistant Metals and Alloys",
    "object_class_label": "Ferritic Structure",
    "object_class_group": "Steel Metallurgy",
    "qualifiers": {
      "TemporalQualifier": "at room temperature",
      "SpatialQualifier": null,
      "OperationalConstraint": null,
      "ConditionExpression": null,
      "UncertaintyQualifier": null,
      "CausalHint": "characterized by",
      "LogicalMarker": null,
      "OtherQualifier": "CategoryType: stainless steel category"
    },
    "confidence": 0.86,
    "remarks": []
  },
  {
    "relation_id": "RelR_d531fbfb64b2",
    "relation_name": "has_metallurgical_structure",
    "rel_desc": "Stainless steels are categorized based on having a martensitic metallurgical structure at room temperature.",
    "rel_hint_type": "structural",
    "canonical_rel_name": "TBD",
    "canonical_rel_desc": "",
    "rel_cls": "TBD",
    "rel_cls_group": "TBD",
    "subject_entity_name": "Stainless Steel",
    "object_entity_name": "martensitic",
    "subject_class_label": "Corrosion-Resistant Alloys",
    "subject_class_group": "Corrosion-Resistant Metals and Alloys",
    "object_class_label": "Martensitic Structure",
    "object_class_group": "Steel Metallurgy",
    "qualifiers": {
      "TemporalQualifier": "at room temperature",
      "SpatialQualifier": null,
      "OperationalConstraint": null,
      "ConditionExpression": null,
      "UncertaintyQualifier": null,
      "CausalHint": "characterized by",
      "LogicalMarker": null,
      "OtherQualifier": "CategoryType: stainless steel category"
    },
    "confidence": 0.86,
    "remarks": []
  }
]

--------------------------------
OUTPUT
--------------------------------

Return ONLY a JSON ARRAY of function calls, e.g.:

[
  {
    "function": "set_rel_schema",
    "args": { ... }
  },
  {
    "function": "modify_relation",
    "args": { ... }
  }
]

- If the cluster is already perfect (rare), you MAY return [].
- Every call MUST include a "justification".
- Use "remark" to flag any issues or uncertainties that are outside the scope of these functions.
